machine:
  ruby:
    version: 2.1.2
  node:
    version: 0.12.2

dependencies:
  pre:
    - echo "{\"mapzen\":{\"api_key\":{\"pelias.mapzen.com\":\"$SEARCH_API_KEY\",\"pelias.mapzen.com\":\"$PELIAS_API_KEY\"}}}" >~/pelias.json

deployment:
  prod:
    branch: production
    commands:
      - git clone git@github.com:pelias/acceptance-tests && cd acceptance-tests && npm install
      - cd acceptance-tests && npm test -- -e prod
      - git clone git@github.com:mapzen/pelias-deploy.git && cd pelias-deploy && bundle install
      - cd pelias-deploy && bundle exec rake deploy:api[prod]
      - cd pelias-deploy && bundle exec rake deploy:api[prod_build]
  test_clone:
    branch: circle-deploy
    commands:
      - git clone git@github.com:mapzen/pelias-deploy.git && cd pelias-deploy && bundle install
